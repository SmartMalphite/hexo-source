---
title: MySQL缓存机制
date: 2022-10-09 21:00:49
categories: 
    - MySQL学习笔记
tags: 
    - MySQL缓存机制
---

## 1. BufferPool

### 1.1 什么是BufferPool
buffer pool 就是内存中的一块缓冲池，用来缓存表和索引的数据。MySQL的数据都是存储在磁盘上的，因此如果每次读写数据都去和磁盘交互的话性能开销较大，所以 innodb 自己维护了一个 buffer pool，在读取数据的时候，会把数据加载到缓冲池中，这样下次再获取就不需要从磁盘读了，直接访问内存中的 buffer pool 即可。更新数据也是一样，直接修改内存中的数据，然后到一定时机才会将这些脏数据刷到磁盘上。

![](https://raw.githubusercontent.com/SmartMalphite/PicBed/master/img-hexo/20221011222909.png)

### 1.2 BufferPool如何保证数据不丢
在更新内存的同时会将更新操作写入redolog, 这样即使在数据落盘前宕机，数据也可以通过redolog恢复

### 1.3 BufferPool如何维护数据
缓冲池维护的是页数据，也就是说，即使你只想从磁盘中获取一条数据，但是 innodb 也会加载一页的数据到缓冲池中，一页默认是 16k。

正常情况下，内存放不下全部的数据库数据，那说明缓冲池需要有淘汰机制，淘汰那些不常被访问的数据页。

按照这个需求，我们很容易想到 `LRU` 机制，最近最少使用的页面将被淘汰，即维护一个链表，被访问的页面移动到头部，新加的页面也加到头部，同时根据内存使用情况淘汰尾部的页面。
